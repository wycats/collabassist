{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"$id": "https://collabassist/cards.schema.json",
	"title": "Card",
	"description": "Union of supported AI UX card types.",
	"oneOf": [
		{ "$ref": "#/$defs/InterpretCard" },
		{ "$ref": "#/$defs/ProposeCard" },
		{ "$ref": "#/$defs/MockupCard" },
		{ "$ref": "#/$defs/LensCard" },
		{ "$ref": "#/$defs/ErrorCard" },
		{ "$ref": "#/$defs/SelectionSummaryCard" }
	],
	"$defs": {
		"BaseCard": {
			"type": "object",
			"properties": {
				"id": { "type": "string" },
				"kind": {
					"type": "string",
					"enum": ["interpret", "propose", "mockup", "lens", "error", "selection-summary"]
				},
				"title": { "type": "string", "minLength": 1 },
				"description": { "type": "string" },
				"flowId": { "type": "string" },
				"stepIndex": { "type": "integer", "minimum": 0 }
			},
			"required": ["id", "kind", "title"],
			"additionalProperties": false
		},
		"InterpretOption": {
			"type": "object",
			"properties": {
				"id": { "type": "string" },
				"label": { "type": "string" },
				"summary": { "type": "string" }
			},
			"required": ["id", "label", "summary"],
			"additionalProperties": false
		},
		"ProposeOption": {
			"type": "object",
			"properties": {
				"id": { "type": "string" },
				"label": { "type": "string" },
				"summary": { "type": "string" }
			},
			"required": ["id", "label", "summary"],
			"additionalProperties": false
		},
		"MockupRegion": {
			"type": "object",
			"properties": {
				"id": { "type": "string" },
				"label": { "type": "string" },
				"layout": {
					"type": "string",
					"enum": ["shelf", "bookcase", "library"]
				},
				"role": {
					"type": "string",
					"enum": ["sidebar", "switcher", "content"]
				},
				"notes": { "type": "string" }
			},
			"required": ["id", "label", "layout"],
			"additionalProperties": false
		},
		"LensPayload": {},
		"InterpretCard": {
			"description": "Use when intent is ambiguous; offer 2–5 interpretations.",
			"allOf": [
				{ "$ref": "#/$defs/BaseCard" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "interpret" },
						"options": {
							"type": "array",
							"items": { "$ref": "#/$defs/InterpretOption" },
							"minItems": 2,
							"maxItems": 5
						}
					},
					"required": ["kind", "options"],
					"additionalProperties": false
				}
			]
		},
		"ProposeCard": {
			"description": "Use when intent is clear and you want to offer 2–5 structured options.",
			"allOf": [
				{ "$ref": "#/$defs/BaseCard" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "propose" },
						"options": {
							"type": "array",
							"items": { "$ref": "#/$defs/ProposeOption" },
							"minItems": 2,
							"maxItems": 5
						}
					},
					"required": ["kind", "options"],
					"additionalProperties": false
				}
			]
		},
		"MockupCard": {
			"description": "Negotiate UI structure via layout regions.",
			"allOf": [
				{ "$ref": "#/$defs/BaseCard" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "mockup" },
						"regions": {
							"type": "array",
							"items": { "$ref": "#/$defs/MockupRegion" },
							"minItems": 1
						}
					},
					"required": ["kind", "regions"],
					"additionalProperties": false
				}
			]
		},
		"LensCard": {
			"description": "Reveal underlying models/state (entities, flows, screens, permissions).",
			"allOf": [
				{ "$ref": "#/$defs/BaseCard" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "lens" },
						"lensType": {
							"type": "string",
							"enum": ["entities", "flows", "screens", "permissions"]
						},
						"payload": { "$ref": "#/$defs/LensPayload" }
					},
					"required": ["kind", "lensType", "payload"],
					"additionalProperties": false
				}
			]
		},
		"ErrorCard": {
			"description": "Graceful failures: missing info, model uncertainty, invalid state.",
			"allOf": [
				{ "$ref": "#/$defs/BaseCard" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "error" },
						"errorKind": {
							"type": "string",
							"enum": ["missing_info", "model_uncertain", "invalid_state"]
						},
						"details": { "type": "string" },
						"recoveryHint": { "type": "string" }
					},
					"required": ["kind", "errorKind"],
					"additionalProperties": false
				}
			]
		},
		"SelectionSummaryCard": {
			"description": "Lightweight acknowledgement of a structured selection.",
			"allOf": [
				{ "$ref": "#/$defs/BaseCard" },
				{
					"type": "object",
					"properties": {
						"kind": { "const": "selection-summary" },
						"selectionId": { "type": "string" },
						"selectionLabel": { "type": "string" },
						"selectionSummary": { "type": "string" },
						"sourceCardKind": {
							"type": "string",
							"enum": ["interpret", "propose"]
						}
					},
					"required": ["kind", "selectionId", "selectionLabel", "sourceCardKind"],
					"additionalProperties": false
				}
			]
		}
	}
}
